{% extends "base.html" %}
{% load static %}
{% block content %}
  <h2>Upload Your Assessment Table</h2>

  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <label for="file">Choose your Excel file:</label><br>
    <input type="file" name="file" id="file" accept=".xlsx,.xls"><br><br>
    <button type="submit" class="btn btn-success">Upload</button>
  </form>

  <hr>

  <p><strong>Tips:</strong></p>
  <ul>
    <li>Include headers like "Student Name", "Score", etc.</li>
    <li>Accepted formats: .xlsx, .xls</li>
    <li><a href="#">Download a sample template</a></li>
  </ul>

  {% if preview_data %}
    <div class="upload-confirmation">
      <p>✅ Your data looks good! Click <strong>Save & Return</strong> to approve and use this data in your dashboard.</p>
    </div>

    <p><span class="missing">Highlighted cells</span> indicate missing scores.</p>

    <table>
      <tr><th>Name</th><th>Score 1</th><th>Score 2</th></tr>
      {% for student in preview_data %}
        <tr>
          <td>{{ student.name }}</td>
          <td class="{% if student.missing_1 %}missing{% endif %}">{{ student.score_1 }}</td>
          <td class="{% if student.missing_2 %}missing{% endif %}">{{ student.score_2 }}</td>
        </tr>
      {% endfor %}
    </table>

    <form method="post" action="{% url 'excel_app:save_students' %}" style="margin-top: 20px;">
      {% csrf_token %}
      <button type="submit" class="btn btn-success">✅ Save & Return to Dashboard</button>
    </form>

    <a href="{% url 'main:dashboard' %}" class="btn btn-outline-secondary" style="margin-top: 10px;">
      ❌ Cancel Upload
    </a>
  {% endif %}
{% endblock %}
